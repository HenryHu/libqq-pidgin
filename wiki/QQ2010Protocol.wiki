#labels QQ,protocol
#QQ 2010 Protocol

= Introduction =

Most works based on the research of many Contributors
I've read Xiaoxia's 2008 Protocol, cqwty's 2009 Protocol, especially shiqishe's QQAnalyzer helps a lot
Massive Thanks to these contributors
Captured packets based QQ 2010 International


= Details =

== 1, Touch 0x91 ==

	=== Touch #1 ===
	==== Client: ====
{{{
02 1E 0D 00 91 5B AB 3D 0A 16 21 02 00 00 00 01
01 01 00 00 64 1F 5C 6E 23 B6 95 1E 43 08 CC 35
0A CE 6C C2 5E 25 A0 3A 1A AC 54 20 4C 4D 02 88
BC D2 06 6B 17 6F FF F0 6C B4 46 8A 9A 82 C6 17
8E C8 78 FC 1F B2 BA B7 BE C6 F0 32 FF AE 50 FF
E1 EF 2A 59 B8 36 03

Header:	02	//Protocol Start Flag
	1E 0D	//Client Version
	00 91	//Cmd (Touch)
	5B AB	//Seq Number
	3D 0A 16 21	//QQ number (Little Endian)
	02 00 00 00 01 01 01 00 00 64 1F	//Unknown filling, 1F differs among versions
Body:	5C 6E 23 B6 95 1E 43 08 CC 35 0A CE 6C C2 5E 25	//128bit Key of TEA
	A0 3A 1A AC 54 20 4C 4D 02 88 BC D2 06 6B 17 6F 
	FF F0 6C B4 46 8A 9A 82 C6 17 8E C8 78 FC 1F B2 
	BA B7 BE C6 F0 32 FF AE 50 FF E1 EF 2A 59 B8 36	//48bytes Encrypted Code of TEA
Tail:	03	//Protocol End Flag

TEA Decode Result:
	00 01 00 00 04 09 01 E0 00 00 03 30 00 00 00 01
	00 00 0B C5 00 00 00 00 00 00 00 00 00 00 00 00
	00 00 00

	00 01	//Fixed
	00 00 04 09 01 E0	//Data1 Version Depended
	00 00 03 30 00 00 00 01 00 00 0B C5	//Data2 Version Depended
 	00 00 00 00 00 00 00 00 00 00 00 00 00 00 00	//15bytes Zero at Touch #1

}}}
------------------------------------------------------------------------

	=== Touch #1 ===
	==== Server: ====	
{{{
02 1E 0D 00 91 5B AB 3D 0A 16 21 00 00 00 7F 54
23 70 EB 3A 04 47 60 9C 81 3F BF 14 85 C8 64 D8
2E 2F AD 54 E9 5A E3 DD 28 B8 68 D6 2B F1 A6 72
77 82 B3 10 98 94 F3 B6 8B 5C B5 66 FD 6D 5F 4F
24 E4 81 2B 8D 5D DE BB AD EE 69 5C 66 C6 06 5F
BC 21 12 97 D5 48 A0 87 3E 5F 86 17 16 32 E5 69
45 28 22 7D 35 ED 87 4D F9 F4 F1 F1 4C 2D C1 AE
72 A4 6E CA 8E E4 03

Header:	02 1E 0D 00 91 2B D8 15 9C 26 AF	//Reference See Above, Same Header as Request
	00 00 00	//Filling
Body:	7F 54 23 70 EB 3A 04 47 60 9C 81 3F BF 14 85 C8 
	64 D8 2E 2F AD 54 E9 5A E3 DD 28 B8 68 D6 2B F1 
	A6 72 77 82 B3 10 98 94 F3 B6 8B 5C B5 66 FD 6D 
	5F 4F 24 E4 81 2B 8D 5D DE BB AD EE 69 5C 66 C6 
	06 5F BC 21 12 97 D5 48 A0 87 3E 5F 86 17 16 32 
	E5 69 45 28 22 7D 35 ED 87 4D F9 F4 F1 F1 4C 2D 
	C1 AE 72 A4 6E CA 8E E4		//104bytes Encrypted Code by TEA, Key same as above
Tail:	03

TEA Decoded Result:
	00 4D 37 37 AD 72 65 B2 97 00 00 00 00 00 00 00 
	00 00 38 D0 DB 26 ED AA 98 68 B3 53 6C 29 28 0C 
	DD 6B BD FE EA DF DE 43 78 FE 99 79 D1 E0 F0 E0 
	69 92 05 C7 D5 C4 BE 04 B5 17 46 C7 BA 34 C5 94 
	A8 C5 36 42 BB C8 47 22 EA 01 24 01 01 00 00 00 
	09 00 00 00 00 70 5A 8A D9 	//89bytes
	
	00	//Flag Touch Success
	4D 37 37 AD	//time_t
	72 65 B2 97	//ip (ntohl>inet_ntoa)
	00 00 00 00 00 00 00 00 //8bytes filling
	00 38	//56bytes (size of Token below)
	D0 DB 26 ED AA 98 68 B3 53 6C 29 28 0C DD 6B BD 
	FE EA DF DE 43 78 FE 99 79 D1 E0 F0 E0 69 92 05 
	C7 D5 C4 BE 04 B5 17 46 C7 BA 34 C5 94 A8 C5 36 
	42 BB C8 47 22 EA 01 24		//56bytes Token
	01	//Flag Redirection needed
	01	//Number Redirected
	00 00 00 09	//Server Flag
	00 00 00 00	//Server Version
	70 5A 8A D9	//IP of Redirection Server
}}}

------------------------------------------------------------------------

	=== Touch #2 Redirect ===
	==== Client: ====
{{{
02 1E 0D 00 91 5B AC 3D 0A 16 21 02 00 00 00 01
01 01 00 00 64 1F 73 41 D9 BD FD A5 E0 47 BE 82
27 16 A1 27 92 11 02 43 7F 62 A7 48 F6 97 D3 7A
48 85 CB 0E 6F 80 DD 69 AD 18 5A 50 EB 63 C0 BD
2E B7 DC CC 2E CB 8F 79 AB A4 CB A3 67 30 EA 68
6D 21 2E 44 A6 22 03

Header:	02	//Protocol Start Flag
	1E 0D	//Client Version
	00 91	//Cmd (Touch)
	5B AC	//Seq Number
	3D 0A 16 21	//QQ number (Little Endian)
	02 00 00 00 01 01 01 00 00 64 1F	//Unknown filling, 1F differs among versions
Body:	73 41 D9 BD FD A5 E0 47 BE 82 27 16 A1 27 92 11	//128bit Key of TEA
	02 43 7F 62 A7 48 F6 97 D3 7A 48 85 CB 0E 6F 80 
	DD 69 AD 18 5A 50 EB 63 C0 BD 2E B7 DC CC 2E CB 
	8F 79 AB A4 CB A3 67 30 EA 68 6D 21 2E 44 A6 22	//48bytes Encrypted Code of TEA
Tail:	03	//Protocol End Flag
		
TEA Decode Result:
	00 01 00 00 04 09 01 E0 00 00 03 30 00 00 00 01
	00 00 0B C5 00 00 00 00 00 00 00 00 00 00 00 00
	00 00 00
	00 01	//Fixed
	00 00 04 09 01 E0	//Data1 Version Depended
	00 00 03 30 00 00 00 01 00 00 0B C5	//Data2 Version Depended
 	00 01 01 00 00 00 09 00 00 00 00 FF FF FF FF	
	//15bytes, Start with 00, Else Same as Requested
	//01 //Redirection Needed
	//01 //Number Redirected
	//00 00 00 09 //Server Flag	
	//00 00 00 00 //Server Version	
	//FF FF FF FF //Originally IP of Redirection Server, Now all FF
}}}

------------------------------------------------------------------------

	=== Touch #2 Redirect ===
	==== Server: ====
{{{
02 1E 0D 00 91 5B AC 3D 0A 16 21 00 00 00 17 1C
48 43 A0 66 8F BC 40 77 0D B5 16 2E FF EA 02 E6
43 07 0E 2B 1A 5B 16 08 C1 B3 0E FB D6 75 83 26
A8 75 7F F5 4C 93 D0 52 12 AA 23 27 24 1C 15 20
1D 5C 6D D0 0D E3 41 EA AF B9 D2 CD 21 F1 71 6C
68 8E D1 04 56 29 E0 91 79 A3 34 C6 D6 C7 30 3C
3E 29 74 F8 4E A0 03
	
Header:	02 1E 0D 00 91 5B AC 3D 0A 16 21	//Reference Above, Same Header as Request
	00 00 00	//Filling
Body:	17 1C 48 43 A0 66 8F BC 40 77 0D B5 16 2E FF EA 
	02 E6 43 07 0E 2B 1A 5B 16 08 C1 B3 0E FB D6 75 
	83 26 A8 75 7F F5 4C 93 D0 52 12 AA 23 27 24 1C 
	15 20 1D 5C 6D D0 0D E3 41 EA AF B9 D2 CD 21 F1 
	71 6C 68 8E D1 04 56 29 E0 91 79 A3 34 C6 D6 C7 
	30 3C 3E 29 74 F8 4E A0		//88bytes Encrypted Code by TEA, Key same as above
Tail:	03

TEA Decoded Result:
	00 4D 37 37 AE 72 65 B2 97 00 00 00 00 00 00 00 
	00 00 38 FF AC 0A 86 BB CD 39 0B D7 7D C2 F2 19 
	1E C1 BA 1D 75 54 8E 2E F8 F7 64 BF F8 C8 6F B9 
	79 66 6D DD 39 A0 4A 56 16 5B F6 D7 15 FA 6C 92 
	4C 02 9F 74 0B E9 9A 05 37 96 31 00 	//76bytes
	
	00	//Flag Touch Success
	4D 37 37 AE	//time_t32
	72 65 B2 97	//ip (ntohl>inet_ntoa)
	00 00 00 00 00 00 00 00 //8bytes filling
	00 38	//56bytes (size of Token below)
	FF AC 0A 86 BB CD 39 0B D7 7D C2 F2 19 1E C1 BA 
	1D 75 54 8E 2E F8 F7 64 BF F8 C8 6F B9 79 66 6D 
	DD 39 A0 4A 56 16 5B F6 D7 15 FA 6C 92 4C 02 9F 
	74 0B E9 9A 05 37 96 31		//56bytes Token
	00	//Flag Touch Success or filling
}}}

-----------------------------------------------------------------------

== 2, Captcha 0xBA ==

	=== Captcha 1# ===
	==== Client: ====
{{{
02 1E 0D 00 BA 4D 86 3D 0A 16 21 02 00 00 00 01
01 01 00 00 64 1F 43 CE 3E 6C 54 72 09 1F 3F E5
54 97 0D 1D 07 AB 98 16 3E 2F 7E 00 D4 C0 AF 48
77 E1 F6 74 20 BB 4E 7C F0 C5 9E 3F 1C 77 C6 38
9B F1 28 02 C8 54 B0 1D 1E 88 96 A8 7E C1 0D 32
23 11 6D AF DE 6D 4F D1 67 38 9C CB 12 54 CC 8A
31 1C 1A 4E 5F 92 83 14 20 0C 60 43 05 36 D1 52
C8 E2 D6 F0 12 8C 92 10 48 BC 6B 92 17 53 E3 A5
38 50 F6 D0 B4 63 CD 2E A3 AB E9 AC 51 47 03

Header:	02 1E 0D 00 BA 4D 86 3D 0A 16 21 02 00 00 00 01
	01 01 01 00 00 64 1F	//Refer above
Body:	43 CE 3E 6C 54 72 09 1F 3F E5 54 97 0D 1D 07 AB	//TEA Key
	98 16 3E 2F 7E 00 D4 C0 AF 48 77 E1 F6 74 20 BB 
	4E 7C F0 C5 9E 3F 1C 77 C6 38 9B F1 28 02 C8 54 
	B0 1D 1E 88 96 A8 7E C1 0D 32 23 11 6D AF DE 6D 
	4F D1 67 38 9C CB 12 54 CC 8A 31 1C 1A 4E 5F 92 
	83 14 20 0C 60 43 05 36 D1 52 C8 E2 D6 F0 12 8C 
	92 10 48 BC 6B 92 17 53 E3 A5 38 50 F6 D0 B4 63 
	CD 2E A3 AB E9 AC 51 47//TEA Value
Tail:	03

TEA Value Decrypted:
	00 01 00 00 04 09 01 E0 00 00 03 30 00 00 00 01 
	00 00 0B C5 00 38 FF AC 0A 86 BB CD 39 0B D7 7D 
	C2 F2 19 1E C1 BA 1D 75 54 8E 2E F8 F7 64 BF F8 
	C8 6F B9 79 66 6D DD 39 A0 4A 56 16 5B F6 D7 15 
	FA 6C 92 4C 02 9F 74 0B E9 9A 05 37 96 31 03 00 
	05 00 00 00 00 00 00 00

	00 01	//Fixed
	00 00 04 09 01 E0	//Data1 Version Depended
	00 00 03 30 00 00 00 01 00 00 0B C5	//Data2 Version Depended
	00 38	//Token Size
	FF AC 0A 86 BB CD 39 0B D7 7D C2 F2 19 1E C1 BA
	1D 75 54 8E 2E F8 F7 64 BF F8 C8 6F B9 79 66 6D
	DD 39 A0 4A 56 16 5B F6 D7 15 FA 6C 92 4C 02 9F
	74 0B E9 9A 05 37 96 31//Token Got thru TOUCH
	03 00 05 00 00 00 00 00 00 00	//Fixed
}}}

-----------------------------------------------------------------------

	=== Captcha 1# ===
	==== Server: ====
{{{	
02 1E 0D 00 BA 4D 86 3D 0A 16 21 00 00 00 6E 0D
32 31 42 96 B5 F5 61 A2 DF 84 76 19 59 D7 11 86
5B 3D 7A 1A 9B 53 9B FF 08 A1 1D 8B DF 61 70 0E
00 2F 94 D6 3C FA 05 0B 69 CE 2A 6E EC 25 A0 CF
82 6B 8B 93 37 99 7E 16 F8 AE 91 0E A4 D1 DD 08
72 92 62 67 87 E2 D7 7A D6 47 07 3C B5 D6 03
	
Header:	02 1E 0D 00 BA 4D 86 3D 0A 16 21 00 00 00	//Refer above
Body:	6E 0D 32 31 42 96 B5 F5 61 A2 DF 84 76 19
	59 D7 11 86 5B 3D 7A 1A 9B 53 9B FF 08 A1 
	1D 8B DF 61 70 0E 00 2F 94 D6 3C FA 05 0B
	69 CE 2A 6E EC 25 A0 CF 82 6B 8B 93 37 99
	7E 16 F8 AE 91 0E A4 D1 DD 08 72 92 62 67
	87 E2 D7 7A D6 47 07 3C B5 D6	//TEA Value using Key Requested
Tail:	03

TEA Value Decrypted:
	03 00 05 00 00 00 00 00 00 38 2B 7A 08 5B 7C 62 
	66 D4 CB 81 C1 7A AB E0 82 EB 6B A0 4F 6F B0 B4 
	A9 55 63 03 9C 86 F1 74 7F 02 12 27 46 56 52 88 
	DD 62 3A 48 6E 73 4D 24 ED 96 DE 96 04 69 65 A9 
	75 63
	
	03	//Flag Check Result, 03 Successful, 04 Captcha Needed
	00 05	//Fixed
	00	//Flag Captcha IsNeeded
	00 00 00 00	//All 00 IF NOT Need Captcha, IF Need, 00 00 01 23
	00 38	//Token Size
	2B 7A 08 5B 7C 62 66 D4 CB 81 C1 7A AB E0 82 EB
	6B A0 4F 6F B0 B4 A9 55 63 03 9C 86 F1 74 7F 02
	12 27 46 56 52 88 DD 62 3A 48 6E 73 4D 24 ED 96
	DE 96 04 69 65 A9 75 63//Token
}}}

-----------------------------------------------------------------------